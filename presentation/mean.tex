\documentclass[beamer]{standalone}
\usepackage{mypackages}

\includeonlyframes{current}
\begin{document}
\newcommand{\MeanPayoffGame}{
\begin{tikzpicture}
      \node (origin) at (0,0) {};
      \node (a) [p2, tok-here=a, left=of origin] {a};
	  \node (b) [p2, tok-here=b, above right=of origin] {b};
	  \node (c) [p1, tok-here=c, below right=of origin] {c};

	  \draw[->]	(a) edge [post] node [below] {-2} (b)
				(a) edge [post] node [above] {-1} (c)
				(b) edge [post] node [left] {2} (c)
				(c) edge [post, bend right=60] node[left] {-2} (b)
				(c) edge [post, bend left=60] node [below] {1} (a)
				(b) edge [post, bend right=60] node [above] {3} (a);

      \begin{scope}[inner sep=2pt, minimum size=1pt]
        \node (box) [p2, color2, right=1cm of c, label={right:Min}] {};
        \node (circ) [p1, color1, above=2mm of box, label={right:Max}] {};
      \end{scope}
  \end{tikzpicture}
}

\newcommand{\MeanPayoffTree}{
    \begin{tikzpicture}[
    every child/.style={norm},
    every node/.style={draw=black,thin},
    norm/.style={edge from parent/.style={draw,black,thin,->}},
    e1/.style={ee=<.(2)-.(3)>1},
    d1/.style={invisible on=<.(3)>},
    d1t/.style={d1,every child/.append style={edge from parent/.append style=d1}},
    e2/.style={ee=<.(4)->2},
    e2t/.style={eet=<.(4)->2},
    d2/.style={invisible on=<.(5)->},
    d2t/.style={d2,every child/.append style={edge from parent/.append style=d2}}
]

		\node[p2, tok-here=a] (a) {a}
            child[e2t] {
				node[p2, tok-here=bl] (bl) {b}
                child[e2t] { node[p1, tok-here=cl] (cl) {c} }
			}
            child[d2t] {
				node[p1,tok-here=cr] (cr) {c}
                child[d1t] { node [p2, tok-here=br] (br) {b} }
			};

            \path[dashed, ->, every node/.append style={draw=none}]
			(cl) edge[e1, out=-60, in=-45, looseness=2] node[right] {0} (bl)
			(cr) edge[d2, e1, out=45, in=0, looseness=1] node[above] {0} (a)
            (cl) edge[out=225,in=160, looseness=2,d1] node[left] {-$\frac{1}{3}$} (a)
            (bl) edge[d2, out=-20,in=-90, looseness=1] node[below right, yshift=0.5em, pos=0.3] {$\frac{1}{2}$} (a)
			(br) edge[d2, out=-45, in=0, looseness=2,d1] node[right] {0} (cr)
			(br) edge[d2, out=225, in=-70,d1] node[left] {0} (a);
    \end{tikzpicture}
}

\newcommand<>{\s}[2]{\onslide#2{#1}}
\newcommand{\countFromHere}[1][+-]{
    \only<#1>{\number\counterDiff{beamerpauses}{overlaynumber}}}

\newcommand{\animateMeanPath}[3][1]{%
    \begin{overlayarea}{#1\textwidth}{2cm}
        \directlua{CmdAnimateMeanPath(\luastring{#2}, \luastringN{#3})}%
    \end{overlayarea}
}

\begin{standaloneframe}{Mean Payoff Games}
    %\newcommand{\ainmateFraction}[1]{
    %\luaexec{
        %local str=require 'std.string'
        %for i=#1,#2
    %}}
    \splitCol*{0.55}{0.40}{
        \stepcounter{beamerpauses}
        \begin{block}{Payoffs}
            \begin{exampleblock}{$(ab)^\omega$ \onslide<.(12)->{Min pays $\frac{1}{2}$ units to Max}}<visible@+->
                \AnimateMyToken{a,b,a,b}
                \animateMeanPath{a/-2, b/+3, a/-2, b/+3, a/-2, b/+3, a/-2}{\sim \tfrac{n(-2+3)}{2n} \to \frac{1}{2}}
            \end{exampleblock}
            \begin{exampleblock}{$(acb)^\omega$ \onslide<.(15)->{Min pays $-\frac{1}{3}$ units to Max}}<visible@+->
                \AnimateMyToken{a,c,b,a,c,b}
                \animateMeanPath{a/-1, c/-2, b/+3, a/-1, c/-2, b/+3, a/-1}{\sim \tfrac{n(-1-2+3)}{3n} \to -\frac{1}{3}}
            \end{exampleblock}
        \end{block}

        \onslide<+->{
        Generally
        \begin{itemize}
            \item Min tries to minimizes $\limsup$
            \item Max tries to maximizes $\liminf$
        \end{itemize}
        }
    }{\scalebox{0.8}{\MeanPayoffGame}}
\end{standaloneframe}

\begin{standaloneframe}{Mean Payoff Games}
    \begin{block}{Questions}
        \begin{itemize}
            \item Does the game have a value? i.e. is there a $v$ so that
                \begin{itemize}
                    \item Max can ensure a payoff $\geq v$
                    \item Min can ensure a payoff $\leq v$
                \end{itemize}
                \visible<2->{\alert{Yes}}
            \item<2-> How to compute the optimal strategies?
        \end{itemize}
    \end{block}
    \visible<4->{Solution using the finite game}
\end{standaloneframe}

\begin{standaloneframe}[label=current]{Mean Payoff}{Finite Game}
    \scalebox{0.7}{\MeanPayoffTree}
    \scalebox{0.7}{\MeanPayoffGame}


    \bigskip
    \visible<.(3),.(5)->{ \alt<.(3)>{Max}{Min} can ensure \alt<.(3)>{$\geq$}{$\leq$} 0 \visible<.(6)->{\alert<.(6)>{in the infinite game too}}}
    \bigskip

    \addtocounter{beamerpauses}{6}
    \splitCol{0.5}{0.5}{
       \fbox{ \begin{overlayarea}{0.95\textwidth}{4em}
            $\pi=$ \enskip \animateStackedPath{a,bl,cl,bl,cl,a,bl,cl,a}
        \end{overlayarea}}
    }{
            \begin{itemize}
                \item<only@.(-1)-.> Every time a cycle with average value $\leq 0$ is eliminated
                \item<only@+> Hence limsup of the average  $\pi$ is $\leq 0$ (see board)
                \item<only@+-> Similarly Max can ensure liminf of the average is $\geq 0$
                \item<only@.> Hence the value of Mean payoff game is 0
            \end{itemize}
            }
\end{standaloneframe}
\end{document}
